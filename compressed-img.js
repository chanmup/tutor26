!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.imageConversion=t():e.imageConversion=t()}(this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,(function(t){return e[t]}).bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function i(e){return["image/png","image/avif","image/jpeg","image/gif","image/webp","image/heic","image/bmp","image/heif","image/tiff"].some(t=>t===e)}function a(e,t=.92,n=g.JPEG){var a,o,r,c;return a=this,o=void 0,r=void 0,c=function*(){return i(n)||(n=g.JPEG),e.toDataURL(n,t)},new(r||(r=Promise))(function(e,t){function n(e){try{u(c.next(e))}catch(n){t(n)}}function i(e){try{u(c.throw(e))}catch(n){t(n)}}function u(t){var a;t.done?e(t.value):((a=t.value)instanceof r?a:new r(function(e){e(a)})).then(n,i)}u((c=c.apply(a,o||[])).next())})}function o(e,t=.92,n=g.JPEG){return new Promise(i=>e.toBlob(e=>i(e),n,t))}function r(e,t){var n,a,o,r;return n=this,a=void 0,o=void 0,r=function*(){let n=e.split(","),a=n[0].match(/:(.*?);/)[1],o=atob(n[1]),r=o.length,c=new Uint8Array(r);for(;r--;)c[r]=o.charCodeAt(r);return i(t)&&(a=t),new Blob([c],{type:a})},new(o||(o=Promise))(function(e,t){function i(e){try{u(r.next(e))}catch(n){t(n)}}function c(e){try{u(r.throw(e))}catch(n){t(n)}}function u(t){var n;t.done?e(t.value):((n=t.value)instanceof o?n:new o(function(e){e(n)})).then(i,c)}u((r=r.apply(n,a||[])).next())})}function c(e){return new Promise((t,n)=>{let i=new Image;i.onload=()=>t(i),i.onerror=()=>n(Error("dataURLtoImage(): dataURL is illegal")),i.src=e})}function u(e,t){let n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t||Date.now().toString(36),document.body.appendChild(n);let i=document.createEvent("MouseEvents");i.initEvent("click",!1,!1),n.dispatchEvent(i),document.body.removeChild(n)}function l(e){return new Promise(t=>{let n=new FileReader;n.onloadend=e=>t(e.target.result),n.readAsDataURL(e)})}function s(e,t={}){var n,i,a,o;return n=this,i=void 0,a=void 0,o=function*(){let n=Object.assign({},t),i=document.createElement("canvas"),a=i.getContext("2d"),o,r;for(let c in n)Object.prototype.hasOwnProperty.call(n,c)&&(n[c]=Number(n[c]));if(n.scale){let u=n.scale>0&&n.scale<10?n.scale:1;r=e.width*u,o=e.height*u}else r=n.width||n.height*e.width/e.height||e.width,o=n.height||n.width*e.height/e.width||e.height;switch([5,6,7,8].some(e=>e===n.orientation)?(i.height=r,i.width=o):(i.height=o,i.width=r),n.orientation){case 3:a.rotate(180*Math.PI/180),a.drawImage(e,-i.width,-i.height,i.width,i.height);break;case 6:a.rotate(90*Math.PI/180),a.drawImage(e,0,-i.width,i.height,i.width);break;case 8:a.rotate(270*Math.PI/180),a.drawImage(e,-i.height,0,i.height,i.width);break;case 2:a.translate(i.width,0),a.scale(-1,1),a.drawImage(e,0,0,i.width,i.height);break;case 4:a.translate(i.width,0),a.scale(-1,1),a.rotate(180*Math.PI/180),a.drawImage(e,-i.width,-i.height,i.width,i.height);break;case 5:a.translate(i.width,0),a.scale(-1,1),a.rotate(90*Math.PI/180),a.drawImage(e,0,-i.width,i.height,i.width);break;case 7:a.translate(i.width,0),a.scale(-1,1),a.rotate(270*Math.PI/180),a.drawImage(e,-i.height,0,i.height,i.width);break;default:a.drawImage(e,0,0,i.width,i.height)}return i},new(a||(a=Promise))(function(e,t){function r(e){try{u(o.next(e))}catch(n){t(n)}}function c(e){try{u(o.throw(e))}catch(n){t(n)}}function u(t){var n;t.done?e(t.value):((n=t.value)instanceof a?n:new a(function(e){e(n)})).then(r,c)}u((o=o.apply(n,i||[])).next())})}function f(e){return fetch(e).then(e=>e.blob())}function d(e){return new Promise((t,n)=>{let i=new Image;i.onload=()=>t(i),i.onerror=()=>n(Error("urltoImage(): Image failed to load, please check the image URL")),i.src=e})}n.r(t),n.d(t,"canvastoDataURL",function(){return a}),n.d(t,"canvastoFile",function(){return o}),n.d(t,"dataURLtoFile",function(){return r}),n.d(t,"dataURLtoImage",function(){return c}),n.d(t,"downloadFile",function(){return u}),n.d(t,"filetoDataURL",function(){return l}),n.d(t,"imagetoCanvas",function(){return s}),n.d(t,"urltoBlob",function(){return f}),n.d(t,"urltoImage",function(){return d}),n.d(t,"compress",function(){return w}),n.d(t,"compressAccurately",function(){return p}),n.d(t,"EImageType",function(){return g}),(h=g||(g={})).PNG="image/png",h.AVIF="image/avif",h.JPEG="image/jpeg",h.GIF="image/gif",h.WEBP="image/webp",h.HEIC="image/heic",h.BMP="image/bmp",h.HEIF="image/heif",h.TIFF="image/tiff";var h,g,m=function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{u(i.next(e))}catch(t){o(t)}}function c(e){try{u(i.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,c)}u((i=i.apply(e,t||[])).next())})};function w(e,t={}){return m(this,void 0,void 0,function*(){if(!(e instanceof Blob))throw Error("compress(): First arg must be a Blob object or a File object.");if("object"!=typeof t&&(t=Object.assign({quality:t})),t.quality=Number(t.quality),Number.isNaN(t.quality))return e;let n=yield l(e),o=n.split(",")[0].match(/:(.*?);/)[1],u=g.JPEG;i(t.type)&&(u=t.type,o=t.type);let f=yield c(n),d=yield s(f,Object.assign({},t)),h=yield a(d,t.quality,u),m=yield r(h,o);return m.size>e.size?e:m})}function p(e,t={}){return m(this,void 0,void 0,function*(){if(!(e instanceof Blob))throw Error("compressAccurately(): First arg must be a Blob object or a File object.");if("object"!=typeof t&&(t=Object.assign({size:t})),t.size=Number(t.size),Number.isNaN(t.size)||1024*t.size>e.size)return e;t.accuracy=Number(t.accuracy),(!t.accuracy||t.accuracy<.8||t.accuracy>.99)&&(t.accuracy=.95);let n=t.size*(2-t.accuracy)*1024,o=1024*t.size,u=t.size*t.accuracy*1024,f=yield l(e),d=f.split(",")[0].match(/:(.*?);/)[1],h=g.JPEG;i(t.type)&&(h=t.type,d=t.type);let m=yield c(f),w=yield s(m,Object.assign({},t)),p,y=.5,v=[null,null];for(let $=1;$<=7;$++){p=yield a(w,y,h);let b=.75*p.length;if(7===$){(n<b||u>b)&&(p=[p,...v].filter(e=>e).sort((e,t)=>Math.abs(.75*e.length-o)-Math.abs(.75*t.length-o))[0]);break}if(n<b)v[1]=p,y-=Math.pow(.5,$+1);else{if(!(u>b))break;v[0]=p,y+=Math.pow(.5,$+1)}}let _=yield r(p,d);return _.size>e.size?e:_})}}])});const data={file:null,compress_file:null,runtime:null};async function init(){let e=await imageConversion.urltoBlob("./img/demo.png");data.file=e;let t=await filetoImage(e);showMessage(e,t,"input"),compress()}function getDom(e){return document.getElementById(e)}async function change(){let e=getDom("file").files[0];data.file=e;let t=await filetoImage(e);showMessage(e,t,"input")}function change2(e){"width"===e||"height"===e?getDom("scale").value="":"scale"===e&&(getDom("width").value="",getDom("height").value="")}function showMessage(e,t,n){let i=(e.size/1024).toFixed(2);if("output"===n){let a=getDom("size").value;getDom(n+"_size").innerText=i+" KB (accuracy:"+((1-Math.abs(1-i/a))*100).toFixed(2)+"%)",data.runtime&&(getDom(n+"_runtime").innerText=data.runtime+" ms")}else getDom("fileName").innerText=e.name||"Choose file",getDom(n+"_size").innerText=i+" KB";getDom(n+"_type").innerText=e.type,getDom(n+"_width").innerText=t.width+" px",getDom(n+"_height").innerText=t.height+" px",getDom(n).innerHTML="",getDom(n).append(t)}async function compress(){let e=data.file,t=getDom("size").value,n=getDom("accuracy").value,i=getDom("type").value,a=getDom("width").value,o=getDom("height").value,r=getDom("scale").value,c=getDom("orientation").value,u=Date.now(),l=await imageConversion.compressAccurately(e,{size:t,accuracy:n,type:i,width:a,height:o,scale:r,orientation:c});data.runtime=Date.now()-u;let s=await filetoImage(l);data.compress_file=l,showMessage(l,s,"output")}async function filetoImage(e){let t=await imageConversion.filetoDataURL(e);return await imageConversion.dataURLtoImage(t)}function download(){imageConversion.downloadFile(data.compress_file)}init();